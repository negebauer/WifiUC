machine:
  environment:
    CI: true
    GYM_CODE_SIGNING_IDENTITY: 'iPhone Distribution: Nicol√°s Gebauer (BJJKE72WM4)'
    ANDROID_HOME: /usr/local/opt/android-sdk
    XCODE_PROJECT: ios/WifiUC.xcodeproj
    XCODE_SCHEME: 'WifiUC'
  xcode:
    version: '8.2'
dependencies:
  pre:
    - # React native stuff
    - brew reinstall node
    - npm install
    - npm install -g react-native-cli
    - npm run generate_env $WIFIUC_USER $WIFIUC_PASS
    - # Android
    - (while sleep 3; do echo "y"; done) | $ANDROID_HOME/tools/android update sdk --no-ui --filter platform-tools,android-24,build-tools-25.0.2
    - security add-generic-password -a android_keystore -l android_keystore -s android_keystore -w $WIFIUC_ANDROID_KEYSTORE
    - # Fastlane
    - sudo gem update fastlane
  cache_directories:
    - node_modules
test:
  pre:
    - npm run lint
  override:
    - npm run test
  post:
    # Bundle iOS
    - react-native bundle --dev false --entry-file index.ios.js --bundle-output ios/build/main.jsbundle --platform ios
    # Bundle Android
    - react-native bundle --dev false --entry-file index.android.js --bundle-output android/build/main.jsbundle --platform android
deployment:
  staging:
    branch: dev
    commands:
      # For now try to build
      - npm run build
