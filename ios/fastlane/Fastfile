require 'pilot'
require 'fastlane_core'

import '../../scripts/Fastfile'

before_all do
  # cocoapods
  puts ENV['ICON']
end

desc 'Build app'
lane :build do
  gym(
    scheme: 'WifiUC',
  )
end

lane :distribute do
  config = FastlaneCore::Configuration.create(Pilot::Options.available_options, {})
  config[:distribute_external] = false
  Pilot::BuildManager.new.distribute(config)
end

desc 'Submit a new Alpha Build to Apple TestFlight'
lane :alpha do
  # badge(shield: "#{VERSION}-#{BUILD}-blue", shield_no_resize: true, alpha: true, dark: false)
  build
  pilot
end

desc 'Submit a new Beta Build to Apple TestFlight'
lane :beta do
  # badge(shield: "#{VERSION}-#{BUILD}-blue", shield_no_resize: true, alpha: false, dark: true)
  build
  pilot
end

desc 'Deploy a new version to the App Store'
lane :release do
  build
  deliver(
    skip_screenshots: true,
    skip_metadata: true,
    submit_for_review: true,
    force: true,
    automatic_release: true,
  )
end

desc 'Upload metada and screenshots'
lane :metadata do
  deliver(
    skip_binary_upload: true,
    skip_screenshots: false,
    skip_metadata: false,
    overwrite_screenshots: true,
    app_icon: ENV['ICON'],
    apple_watch_app_icon: ENV['ICON_WATCH'],
    force: true,
    app_version: VERSION,
  )
end

after_all do |lane|

end

error do |lane, exception|

end
